{% load static %}

<div class="d-flex flex-row justify-content-left">

    <div class="d-flex align-items-start" style="padding: .9rem 0rem .0rem .0rem;">
        <form id="vote-like-form{{obj.id}}">
            {% csrf_token %}
            <button data-type="{{type}}" data-action="like" type="submit" class="btn">
                <i class="fa fa-thumbs-up fa-lg" aria-hidden="true">
                    <span id="total-likes{{obj.id}}">{{obj.votes.count_likes}}</span>
                </i>
            </button>
        </form>
    </div>

    <div class="d-flex align-items-start" style="padding: .9rem 0rem .0rem .0rem;">
        <form id="vote-dislike-form{{obj.id}}">
            {% csrf_token %}
            <button data-type="{{type}}" data-action="dislike" type="submit" class="btn">
                <i class="fa fa-thumbs-down fa-lg" aria-hidden="true">
                    <span id="total-dislikes{{obj.id}}">{{ obj.votes.count_dislikes}}</span>
                </i>
            </button>
        </form>
    </div>
</div>

<script>
$( document ).ready(function() {
    const pk = '{{obj.id}}'
    const likeForm = $(`#vote-like-form${pk}`);
    const dislikeForm = $(`#vote-dislike-form${pk}`);
    const likeCounter = document.getElementById(`total-likes${pk}`);
    const dislikeCounter = document.getElementById(`total-dislikes${pk}`);
    const domain = window.location.origin
    likeForm.on("submit", function(e) {
        e.preventDefault();
        e.stopImmediatePropagation();

        var likeBtn = $(this).find('button');
        var type = likeBtn.data('type');

        $.ajax({
            type: 'POST',
            url: domain + '/votes/' + type + '/like/' + pk + '/',
            data: {
                'pk': pk,
                'csrfmiddlewaretoken': '{{csrf_token}}'
            },

            success: function(response) {
                likeCounter.innerHTML = response.total_likes;
                dislikeCounter.innerHTML = response.total_dislikes;
            },

        });
    });

    dislikeForm.on("submit", function(e) {
        e.preventDefault();
        e.stopImmediatePropagation();

        var dislikeBtn = $(this).find('button');
        var type = dislikeBtn.data('type');

        $.ajax({
            type: 'POST',
            url: domain + '/votes/' + type + '/dislike/' + pk + '/',
            data: {
                'pk': pk,
                'csrfmiddlewaretoken': '{{csrf_token}}'
            },

            success: function(response) {
                likeCounter.innerHTML = response.total_likes;
                dislikeCounter.innerHTML = response.total_dislikes;
            },

        });
    });

});
</script>